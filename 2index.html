<!DOCTYPE html>
<html lang="en">
<head>
    <meta content='width=device-width, initial-scale=1' name='viewport'/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Maker+ Ci</title>
    <link rel="stylesheet" href="style.css">
    <script src="jquery.js"></script>
    <script src="stringsimilarity.js"></script>
    <script src="indenter.js"></script>
    <script src="modelist.js"></script>
    <script src="Aliases.js"></script>
    <script src="aliases2.js"></script>
    <script src="link.js"></script> 
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            width:100%;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }
        #parent {
            width:100%;
            height: 150px;
            display:inline-block;
            position:relative;
        }
        #editor * { 
            font-family: monospace !important;
        }
        #fileOpener {
            display: block;
            visibility: hidden;
            width: 0;
            height: 0;
        }
    </style>
</head>
<body onload="generateList();">

    <button onclick="openFile();" style="height:20px;" type="button">+</button>
    <button onclick='saveFile();' style="height:20px;" type="button">save</button>
    <button id='stateofbeing' onclick="alert(this.textContent)" style="width:200px; height:20px;" type="button">Maker+ Ci</button>
    <button onclick='closeFile();' style="height:20px;" type="button">x</button>
    <button onclick='runIt(editor.getValue()); newText ="";' style="height:20px;" type="button">Run</button>

    <br><br>

    <div class="card">
        <div class="card-body">
            <div id="parent">
                <div id="editor" tabindex="0"></div>
            </div>
            <br><br>
            <div id="card21"></div>
            <br><br>
            <div id="card22"></div>
        </div>
    </div>

    <input id="fileOpener" type="file" name="somename" size="chars" onChange="onChange(event)">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.13/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="defaults.js"></script>
    <script src="Js2.js"></script>

    <script>
        // Function to get all function/method blocks and HTML tags with their contents
        function getFunctionsAndTags(content) {
            let functionBlocks = [];
            let htmlBlocks = [];

            // Regular expression to find complete functions/methods including their contents
            let functionRegex = /function\s+([a-zA-Z0-9_]+)\s*\([^)]*\)\s*\{[^}]*\}/gs;
            let match;
            while ((match = functionRegex.exec(content)) !== null) {
                functionBlocks.push({
                    name: match[1],
                    content: match[0]
                });
            }

            // Regular expression to find HTML tags including their contents
            let htmlTagRegex = /<([a-zA-Z0-9]+)[^>]*>[^<]*<\/\1>/gs;
            while ((match = htmlTagRegex.exec(content)) !== null) {
                htmlBlocks.push({
                    name: match[1],
                    content: match[0]
                });
            }

            return { functionBlocks, htmlBlocks };
        }

        // Function to display the list in card22
        function displayList(functionBlocks, htmlBlocks) {
            const card22 = document.getElementById('card22');
            card22.innerHTML = '';  // Clear existing content

            // Add function blocks to the list
            functionBlocks.forEach(func => {
                let listItem = document.createElement('div');
                listItem.textContent = 'Function: ' + func.name;
                listItem.style.cursor = 'pointer';
                listItem.onclick = () => selectText(func.content);
                card22.appendChild(listItem);
            });

            // Add HTML blocks to the list
            htmlBlocks.forEach(tag => {
                let listItem = document.createElement('div');
                listItem.textContent = 'HTML Tag: <' + tag.name + '>';
                listItem.style.cursor = 'pointer';
                listItem.onclick = () => selectText(tag.content);
                card22.appendChild(listItem);
            });
        }

        // Function to select the text in the editor
        function selectText(block) {
            let editor = ace.edit("editor");
            let range = editor.find(block);

            // Move the cursor to the beginning of the selection and select the range
            editor.selection.setRange(range);
            editor.scrollToLine(range.start.row, true, true, function () {});
        }

        // Function to initialize the list generation and display
        function generateList() {
            let editor = ace.edit("editor");
            let content = editor.getValue();
            let { functionBlocks, htmlBlocks } = getFunctionsAndTags(content);
            displayList(functionBlocks, htmlBlocks);
        }

        // Initialize Ace Editor
        let editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/javascript");

        // Trigger list generation when the content changes
        editor.session.on('change', generateList);
    </script>
</body>
</html>
